"""å‡å€¼ï¼ˆMeansï¼‰ç¤ºä¾‹ä¸é‡‘èæ•°æ®æ¼”ç¤º

å‚è€ƒä¸çµæ„Ÿæ¥æºï¼š
- ç¬¬ 6 è®²ï¼šå‡å€¼ (Means)ï¼ˆæç‚¼è‡ªç¤ºä¾‹ä»£ç ï¼‰
  é“¾æ¥: https://wqu.guru/blog/quantopia-quantitative-analysis-56-lectures/means

è¿è¡Œæ–¹å¼ï¼ˆæ¨èä½¿ç”¨ uvï¼‰ï¼š
- ä½œä¸ºæ¨¡å—è¿è¡Œï¼šuv run -m quant.means_demo
- ä½œä¸ºè„šæœ¬è¿è¡Œï¼šuv run quant/means_demo.py

æœ¬è„šæœ¬åŒ…å«ï¼š
1) åŸºç¡€ç»Ÿè®¡é‡ç¤ºä¾‹ï¼šç®—æœ¯å¹³å‡ã€å‡ ä½•å¹³å‡ã€è°ƒå’Œå¹³å‡ã€ä¼—æ•°ã€ä¸­ä½æ•°
2) é‡‘èæ•°æ®ç¤ºä¾‹ï¼šä¸‹è½½ SPY æ—¥çº¿ï¼Œè®¡ç®—æ”¶ç›Šç‡å‡å€¼/ä¸­ä½æ•°/ä¼—æ•°ä¸å‡ ä½•å¹³å‡æ”¶ç›Šç‡

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              æ•°å­¦æ¦‚å¿µè¯¦è§£
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. ç®—æœ¯å¹³å‡æ•° (Arithmetic Mean)
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   å…¬å¼ï¼šÎ¼ = (1/n) Ã— Î£(xi)ï¼Œå…¶ä¸­ i ä» 1 åˆ° n

   æ•°å­¦æ„ä¹‰ï¼š
   - æ‰€æœ‰è§‚æµ‹å€¼çš„æ€»å’Œé™¤ä»¥è§‚æµ‹å€¼ä¸ªæ•°
   - æ•°æ®çš„"é‡å¿ƒ"ä½ç½®ï¼Œä½¿å¾—å„ç‚¹åˆ°è¯¥ç‚¹è·ç¦»çš„å¹³æ–¹å’Œæœ€å°
   - å¯¹å¼‚å¸¸å€¼æ•æ„Ÿï¼Œä¸€ä¸ªæç«¯å€¼ä¼šæ˜¾è‘—å½±å“ç»“æœ

   åº”ç”¨åœºæ™¯ï¼š
   - æè¿°æ•°æ®çš„å…¸å‹æ°´å¹³
   - æ­£æ€åˆ†å¸ƒæ•°æ®çš„æœ€ä½³ä¸­å¿ƒä¼°è®¡
   - çº¿æ€§å›å½’ä¸­çš„åŸºç¡€ç»Ÿè®¡é‡

2. ä¸­ä½æ•° (Median)
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   å®šä¹‰ï¼šå°†æ•°æ®æ’åºåä½äºä¸­é—´ä½ç½®çš„å€¼

   æ•°å­¦ç‰¹æ€§ï¼š
   - 50% åˆ†ä½æ•°ï¼Œå°†æ•°æ®åˆ†ä¸ºä¸¤ç­‰ä»½
   - å¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿï¼ˆç¨³å¥ç»Ÿè®¡é‡ï¼‰
   - åæ€åˆ†å¸ƒçš„æ›´å¥½ä¸­å¿ƒåº¦é‡

   è®¡ç®—æ–¹æ³•ï¼š
   - å¥‡æ•°ä¸ªæ•°æ®ï¼šå–ä¸­é—´å€¼
   - å¶æ•°ä¸ªæ•°æ®ï¼šå–ä¸­é—´ä¸¤ä¸ªå€¼çš„å¹³å‡

3. ä¼—æ•° (Mode)
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   å®šä¹‰ï¼šå‡ºç°é¢‘ç‡æœ€é«˜çš„æ•°å€¼

   ç‰¹ç‚¹ï¼š
   - å”¯ä¸€èƒ½ç”¨äºåˆ†ç±»æ•°æ®çš„é›†ä¸­è¶‹åŠ¿åº¦é‡
   - å¯èƒ½ä¸å­˜åœ¨ï¼ˆæ— é‡å¤å€¼ï¼‰æˆ–å­˜åœ¨å¤šä¸ª
   - æè¿°æ•°æ®çš„"æœ€å¸¸è§"ç‰¹å¾

   ç±»å‹ï¼š
   - å•å³°åˆ†å¸ƒï¼šä¸€ä¸ªä¼—æ•°
   - åŒå³°åˆ†å¸ƒï¼šä¸¤ä¸ªä¼—æ•°
   - å¤šå³°åˆ†å¸ƒï¼šå¤šä¸ªä¼—æ•°

4. å‡ ä½•å¹³å‡æ•° (Geometric Mean)
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   å…¬å¼ï¼šG = â¿âˆš(xâ‚ Ã— xâ‚‚ Ã— ... Ã— xâ‚™) = (âˆxi)^(1/n)

   æ•°å­¦ç‰¹æ€§ï¼š
   - æ‰€æœ‰å€¼ä¹˜ç§¯çš„ n æ¬¡æ–¹æ ¹
   - å§‹ç»ˆ â‰¤ ç®—æœ¯å¹³å‡æ•°ï¼ˆAM-GM ä¸ç­‰å¼ï¼‰
   - å¯¹æ•°å˜æ¢åç­‰äºç®—æœ¯å¹³å‡æ•°çš„æŒ‡æ•°

   é€‚ç”¨æ¡ä»¶ï¼š
   - æ‰€æœ‰æ•°å€¼å¿…é¡»ä¸ºæ­£æ•°
   - æ•°æ®å…·æœ‰ä¹˜æ€§å…³ç³»
   - æ¯”ç‡å’Œå¢é•¿ç‡çš„å¹³å‡åŒ–

5. è°ƒå’Œå¹³å‡æ•° (Harmonic Mean)
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   å…¬å¼ï¼šH = n / Î£(1/xi)

   æ•°å­¦ç‰¹æ€§ï¼š
   - å€’æ•°çš„ç®—æœ¯å¹³å‡æ•°çš„å€’æ•°
   - ä¸‰ç§å¹³å‡æ•°ä¸­æœ€å°ï¼šH â‰¤ G â‰¤ A
   - å¯¹å°æ•°å€¼æ›´æ•æ„Ÿ

   å…¸å‹åº”ç”¨ï¼š
   - é€Ÿåº¦çš„å¹³å‡ï¼ˆæ—¶é—´å›ºå®šï¼Œè·ç¦»å˜åŒ–ï¼‰
   - ä»·æ ¼çš„å¹³å‡ï¼ˆP/E æ¯”ç‡ç­‰ï¼‰
   - ç”µé˜»å¹¶è”è®¡ç®—

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              é‡‘èæ¦‚å¿µè¯¦è§£
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. æ”¶ç›Šç‡ (Return)
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   ç®€å•æ”¶ç›Šç‡ï¼šR = (P_t - P_{t-1}) / P_{t-1}

   é‡‘èæ„ä¹‰ï¼š
   - è¡¡é‡æŠ•èµ„åœ¨å•ä½æ—¶é—´å†…çš„ç›¸å¯¹æ”¶ç›Š
   - æ¶ˆé™¤äº†ä»·æ ¼æ°´å¹³çš„å½±å“ï¼Œä¾¿äºæ¯”è¾ƒä¸åŒèµ„äº§
   - å¯ä»¥ç›´æ¥åŠ æ€»è®¡ç®—ç»„åˆæ”¶ç›Šç‡

   ç‰¹ç‚¹ï¼š
   - èŒƒå›´ï¼š-1 åˆ° +âˆ
   - ä¸å…·å¤‡æ—¶é—´å¯åŠ æ€§
   - é€‚åˆçŸ­æœŸåˆ†æå’Œæ¨ªæˆªé¢æ¯”è¾ƒ

2. å‡ ä½•å¹³å‡æ”¶ç›Šç‡ (Geometric Mean Return)
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   å…¬å¼ï¼šR_g = [(1+Râ‚)(1+Râ‚‚)...(1+Râ‚™)]^(1/n) - 1

   é‡‘èæ„ä¹‰ï¼š
   - å¤åˆå¢é•¿ç‡ï¼Œè€ƒè™‘äº†å¤åˆ©æ•ˆåº”
   - çœŸå®åæ˜ é•¿æœŸæŠ•èµ„çš„å¹³å‡æ”¶ç›Šæ°´å¹³
   - ç”¨äºè®¡ç®—å¹´åŒ–æ”¶ç›Šç‡

   é‡è¦æ€§ï¼š
   - æ—¶é—´åŠ æƒæ”¶ç›Šç‡çš„åŸºç¡€
   - æ¶ˆé™¤äº†æ³¢åŠ¨æ€§å¯¹å¹³å‡æ”¶ç›Šçš„å½±å“
   - æŠ•èµ„ä¸šç»©è¯„ä¼°çš„æ ‡å‡†æŒ‡æ ‡

   éªŒè¯å…¬å¼ï¼š
   æœ€ç»ˆä»·å€¼ = åˆå§‹ä»·å€¼ Ã— (1 + R_g)^T
   å…¶ä¸­ T ä¸ºæŠ•èµ„æœŸæ•°

3. SPY ETF
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   å…¨ç§°ï¼šSPDR S&P 500 ETF Trust

   ç‰¹ç‚¹ï¼š
   - è·Ÿè¸ªæ ‡æ™® 500 æŒ‡æ•°çš„äº¤æ˜“æ‰€äº¤æ˜“åŸºé‡‘
   - åŒ…å«ç¾å›½ 500 å®¶æœ€å¤§ä¸Šå¸‚å…¬å¸
   - ä»£è¡¨ç¾å›½è‚¡å¸‚çš„æ•´ä½“è¡¨ç°
   - æµåŠ¨æ€§æé«˜ï¼Œäº¤æ˜“æˆæœ¬ä½

   åˆ†æä»·å€¼ï¼š
   - å¸‚åœºåŸºå‡†ï¼Œç”¨äºæ¯”è¾ƒå…¶ä»–æŠ•èµ„çš„è¡¨ç°
   - ç³»ç»Ÿæ€§é£é™©çš„ä»£è¡¨
   - å®è§‚ç»æµè¶‹åŠ¿çš„åæ˜ 

4. æ”¶ç›Šç‡åˆ†å¸ƒç‰¹å¾
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   å‡å€¼ vs ä¸­ä½æ•°ï¼š
   - å‡å€¼ > ä¸­ä½æ•°ï¼šå³ååˆ†å¸ƒï¼ˆæ­£åæ€ï¼‰
   - å‡å€¼ < ä¸­ä½æ•°ï¼šå·¦ååˆ†å¸ƒï¼ˆè´Ÿåæ€ï¼‰
   - å‡å€¼ â‰ˆ ä¸­ä½æ•°ï¼šå¯¹ç§°åˆ†å¸ƒ

   ä¼—æ•°çš„æ„ä¹‰ï¼š
   - æœ€å¸¸å‡ºç°çš„æ”¶ç›Šç‡æ°´å¹³
   - å¸‚åœº"æ­£å¸¸"çŠ¶æ€çš„æŒ‡ç¤º
   - è¿ç»­æ•°æ®éœ€è¦åˆ†ç»„å¤„ç†

   å®é™…åº”ç”¨ï¼š
   - é£é™©è¯„ä¼°ï¼šåˆ†å¸ƒå½¢çŠ¶å½±å“é£é™©åº¦é‡
   - æŠ•èµ„å†³ç­–ï¼šäº†è§£æ”¶ç›Šç‡çš„å…¸å‹ç‰¹å¾
   - æ¨¡å‹é€‰æ‹©ï¼šé€‰æ‹©åˆé€‚çš„æ¦‚ç‡åˆ†å¸ƒæ¨¡å‹

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            æ•°å€¼è§£é‡Šä¸ç›´è§‰ç†è§£
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ä¸ºä»€ä¹ˆå‡ ä½•å¹³å‡æ•° < ç®—æœ¯å¹³å‡æ•°ï¼Ÿ
- å‡ ä½•å¹³å‡è€ƒè™‘å¤åˆ©æ•ˆåº”ï¼Œæ›´ä¿å®ˆ
- æ³¢åŠ¨æ€§ä¼šé™ä½å‡ ä½•å¹³å‡æ”¶ç›Šç‡
- ä½“ç°äº†"æ³¢åŠ¨æ‹–ç´¯"æ•ˆåº”

ä¸ºä»€ä¹ˆä½¿ç”¨ä¸åŒçš„å¹³å‡æ•°ï¼Ÿ
- ç®—æœ¯å¹³å‡ï¼šæœŸæœ›æ”¶ç›Šç‡ï¼Œç”¨äºèµ„äº§é…ç½®
- å‡ ä½•å¹³å‡ï¼šå®é™…å¢é•¿ç‡ï¼Œç”¨äºä¸šç»©è¯„ä¼°
- è°ƒå’Œå¹³å‡ï¼šç‰¹æ®Šæ¯”ç‡è®¡ç®—ï¼Œå¦‚å¹³å‡P/E

é‡‘èæ•°æ®çš„ç‰¹æ®Šæ€§ï¼š
- æ”¶ç›Šç‡é€šå¸¸å‘ˆç°å°–å³°åšå°¾åˆ†å¸ƒ
- å­˜åœ¨æ³¢åŠ¨æ€§èšé›†ç°è±¡
- æç«¯å€¼ï¼ˆé»‘å¤©é¹…äº‹ä»¶ï¼‰å½±å“æ˜¾è‘—
"""

from __future__ import annotations

from dataclasses import dataclass
from typing import List, Sequence, Union

import numpy as np
from scipy import stats

try:
    import yfinance as yf

    YFINANCE_AVAILABLE = True
except Exception:  # æ˜ç¡®ä»…æ•è·å¯¼å…¥å¤±è´¥ç­‰å¼‚å¸¸
    YFINANCE_AVAILABLE = False


Number = Union[int, float, np.floating]


def calculate_mode(values: Sequence[Number]) -> Union[str, List[Number]]:
    """è®¡ç®—ä¼—æ•°ï¼ˆä¸å‚è€ƒä»£ç ä¸€è‡´çš„ç›´è§‚å®ç°ï¼‰ã€‚

    ä¼—æ•°ï¼ˆModeï¼‰æ•°å­¦å®šä¹‰ï¼š
    - åœ¨ä¸€ç»„æ•°æ®ä¸­å‡ºç°é¢‘ç‡æœ€é«˜çš„æ•°å€¼
    - å¯¹äºè¿ç»­æ•°æ®ï¼Œé€šå¸¸éœ€è¦å…ˆåˆ†ç»„ï¼ˆåˆ†ç®±ï¼‰å¤„ç†
    - æ˜¯å”¯ä¸€å¯ä»¥ç”¨äºåˆ†ç±»æ•°æ®çš„é›†ä¸­è¶‹åŠ¿åº¦é‡

    é‡‘èåº”ç”¨ï¼š
    - è¯†åˆ«æœ€å¸¸è§çš„æ”¶ç›Šç‡æ°´å¹³
    - å‘ç°å¸‚åœºçš„"æ­£å¸¸"çŠ¶æ€
    - å¤šå³°åˆ†å¸ƒå¯èƒ½æš—ç¤ºå¸‚åœºå­˜åœ¨ä¸åŒçš„è¿è¡ŒçŠ¶æ€

    ç»Ÿè®¡ç‰¹æ€§ï¼š
    - å¯èƒ½ä¸å­˜åœ¨ï¼ˆæ‰€æœ‰å€¼éƒ½ä¸åŒï¼‰
    - å¯èƒ½å­˜åœ¨å¤šä¸ªï¼ˆå¤šå³°åˆ†å¸ƒï¼‰
    - å¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿ

    å‚æ•°ï¼š
        values: æ•°å€¼åºåˆ—

    è¿”å›ï¼š
        str: "No mode" è¡¨ç¤ºæ— ä¼—æ•°
        List[Number]: ä¼—æ•°åˆ—è¡¨ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼‰

    å½“å­˜åœ¨å¤šä¸ªä¼—æ•°æ—¶è¿”å›åˆ—è¡¨ï¼›è‹¥æ²¡æœ‰ä¼—æ•°ï¼ˆæ‰€æœ‰é¢‘æ¬¡ç›¸åŒä¸”>1 ä¹‹å‰çš„å®ç°ä¼šè¿”å› 'No mode'ï¼‰ï¼Œ
    è¿™é‡Œçº¦å®šï¼šå½“æ¯ä¸ªå€¼åªå‡ºç°ä¸€æ¬¡ä¸”å…ƒç´ æ•°é‡>1 æ—¶ï¼Œè¿”å› 'No mode'ã€‚
    """
    counts: dict[Number, int] = {}
    for element in values:
        counts[element] = counts.get(element, 0) + 1

    if not counts:
        return "No mode"

    max_count = max(counts.values(), default=0)
    # ä¸å‚è€ƒå®ç°ä¿æŒä¸€è‡´çš„è¯­ä¹‰ï¼šå½“ max_count < 1ï¼ˆä¸ä¼šå‘ç”Ÿï¼‰æˆ–æ²¡æœ‰é‡å¤å…ƒç´ æ—¶è¿”å› No mode
    if max_count <= 1 and len(values) > 1:
        return "No mode"

    modes = [k for k, v in counts.items() if v == max_count]
    return modes if modes else "No mode"


@dataclass
class BasicMeansResult:
    mean_x1: float
    mean_x2: float
    median_x1: Number
    median_x2: Number
    mode_x1: Union[str, List[Number]]
    mode_x2: Union[str, List[Number]]
    gmean_x1: float
    gmean_x2: float
    hmean_x1: float
    hmean_x2: float


def demo_basic_means() -> BasicMeansResult:
    """åŸºç¡€ç»Ÿè®¡é‡æ¼”ç¤ºï¼Œæç‚¼è‡ªå‚è€ƒç¤ºä¾‹ã€‚

    æœ¬å‡½æ•°æ¼”ç¤ºäº”ç§é‡è¦çš„é›†ä¸­è¶‹åŠ¿åº¦é‡ï¼š

    1. ç®—æœ¯å¹³å‡æ•° (Arithmetic Mean)ï¼š
       - æ•°å­¦æœŸæœ›çš„æ— åä¼°è®¡
       - å…¬å¼ï¼šÎ¼ = Î£xi / n
       - ç‰¹ç‚¹ï¼šå¯¹å¼‚å¸¸å€¼æ•æ„Ÿï¼Œé€‚åˆæ­£æ€åˆ†å¸ƒæ•°æ®

    2. ä¸­ä½æ•° (Median)ï¼š
       - 50% åˆ†ä½æ•°ï¼Œç¨³å¥ç»Ÿè®¡é‡
       - ç‰¹ç‚¹ï¼šå¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿï¼Œé€‚åˆåæ€åˆ†å¸ƒ

    3. ä¼—æ•° (Mode)ï¼š
       - æœ€é¢‘ç¹å‡ºç°çš„å€¼
       - ç‰¹ç‚¹ï¼šå¯ç”¨äºåˆ†ç±»æ•°æ®ï¼Œå¯èƒ½ä¸å­˜åœ¨æˆ–æœ‰å¤šä¸ª

    4. å‡ ä½•å¹³å‡æ•° (Geometric Mean)ï¼š
       - å¢é•¿ç‡çš„å¹³å‡ï¼Œè€ƒè™‘å¤åˆ©æ•ˆåº”
       - å…¬å¼ï¼šG = (âˆxi)^(1/n)
       - ç‰¹ç‚¹ï¼šé€‚åˆæ¯”ç‡æ•°æ®ï¼ŒG â‰¤ ç®—æœ¯å¹³å‡

    5. è°ƒå’Œå¹³å‡æ•° (Harmonic Mean)ï¼š
       - å€’æ•°çš„ç®—æœ¯å¹³å‡çš„å€’æ•°
       - å…¬å¼ï¼šH = n / Î£(1/xi)
       - ç‰¹ç‚¹ï¼šå¯¹å°å€¼æ•æ„Ÿï¼ŒH â‰¤ G â‰¤ A

    æ¼”ç¤ºæ•°æ®ï¼š
    - x1 = [1,2,2,3,4,5,5,7]ï¼šæ­£å¸¸åˆ†å¸ƒï¼Œæœ‰ä¼—æ•°
    - x2 = x1 + [100]ï¼šæ·»åŠ å¼‚å¸¸å€¼ï¼Œè§‚å¯Ÿå„ç»Ÿè®¡é‡çš„å˜åŒ–

    è¿”å›ï¼š
        BasicMeansResult: åŒ…å«æ‰€æœ‰ç»Ÿè®¡é‡çš„ç»“æœå¯¹è±¡
    """
    x1 = [1, 2, 2, 3, 4, 5, 5, 7]
    x2 = x1 + [100]

    mean_x1 = float(np.mean(x1))
    mean_x2 = float(np.mean(x2))

    median_x1 = np.median(x1)
    median_x2 = np.median(x2)

    mode_x1 = calculate_mode(x1)
    mode_x2 = calculate_mode(x2)

    gmean_x1 = float(stats.gmean(x1))
    gmean_x2 = float(stats.gmean(x2))

    hmean_x1 = float(stats.hmean(x1))
    hmean_x2 = float(stats.hmean(x2))

    return BasicMeansResult(
        mean_x1=mean_x1,
        mean_x2=mean_x2,
        median_x1=median_x1,
        median_x2=median_x2,
        mode_x1=mode_x1,
        mode_x2=mode_x2,
        gmean_x1=gmean_x1,
        gmean_x2=gmean_x2,
        hmean_x1=hmean_x1,
        hmean_x2=hmean_x2,
    )


@dataclass
class FinanceMeansResult:
    mean: float
    median: float
    mode: Union[str, List[Number]]
    geometric_mean_return: float
    actual_final_price: float
    gmean_check_price: float
    periods: int


def demo_finance_means(
    ticker: str = "SPY",
    start: str = "2014-01-01",
    end: str = "2015-01-01",
) -> FinanceMeansResult:
    """ä¸‹è½½é‡‘èæ•°æ®å¹¶è®¡ç®—æ”¶ç›Šç‡çš„å‡å€¼/ä¸­ä½æ•°/ä¼—æ•°ä¸å‡ ä½•å¹³å‡æ”¶ç›Šç‡ã€‚

    é‡‘èæ—¶é—´åºåˆ—åˆ†æçš„æ ¸å¿ƒæ¦‚å¿µï¼š

    1. ç®€å•æ”¶ç›Šç‡è®¡ç®—ï¼š
       - å…¬å¼ï¼šR_t = (P_t - P_{t-1}) / P_{t-1}
       - æ„ä¹‰ï¼šå•æœŸç›¸å¯¹æ”¶ç›Šï¼Œä¾¿äºä¸åŒèµ„äº§æ¯”è¾ƒ
       - ç‰¹ç‚¹ï¼šå¯åŠ æ€§ï¼Œé€‚åˆç»„åˆåˆ†æ

    2. æ”¶ç›Šç‡ç»Ÿè®¡ç‰¹å¾ï¼š
       - å‡å€¼ï¼šæœŸæœ›æ”¶ç›Šç‡ï¼Œç”¨äºèµ„äº§é…ç½®å†³ç­–
       - ä¸­ä½æ•°ï¼šç¨³å¥çš„ä¸­å¿ƒè¶‹åŠ¿ï¼Œä¸å—æç«¯å€¼å½±å“
       - ä¼—æ•°ï¼šæœ€å¸¸è§çš„æ”¶ç›Šç‡ï¼Œåæ˜ å¸‚åœº"æ­£å¸¸"çŠ¶æ€

    3. å‡ ä½•å¹³å‡æ”¶ç›Šç‡ï¼š
       - å…¬å¼ï¼šR_g = [(1+Râ‚)(1+Râ‚‚)...(1+Râ‚™)]^(1/n) - 1
       - æ„ä¹‰ï¼šå¤åˆå¹´å¢é•¿ç‡ï¼Œè€ƒè™‘å¤åˆ©æ•ˆåº”
       - åº”ç”¨ï¼šä¸šç»©è¯„ä¼°ã€é•¿æœŸæŠ•èµ„è§„åˆ’

    4. éªŒè¯æœºåˆ¶ï¼š
       - é€šè¿‡å‡ ä½•å¹³å‡æ”¶ç›Šç‡åæ¨æœ€ç»ˆä»·æ ¼
       - å…¬å¼ï¼šP_T = P_0 Ã— (1 + R_g)^T
       - ç›®çš„ï¼šç¡®ä¿è®¡ç®—çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§

    5. SPY ETF ç‰¹ç‚¹ï¼š
       - è·Ÿè¸ªæ ‡æ™®500æŒ‡æ•°ï¼Œä»£è¡¨ç¾å›½å¤§ç›˜è‚¡è¡¨ç°
       - é«˜æµåŠ¨æ€§ï¼Œä½è´¹ç”¨ï¼Œæ˜¯ç†æƒ³çš„åŸºå‡†èµ„äº§
       - åŒ…å«500å®¶å¤§å‹ä¼ä¸šï¼Œåˆ†æ•£åŒ–ç¨‹åº¦é«˜

    é‡‘èç›´è§‰ï¼š
    - å‡ ä½•å¹³å‡ < ç®—æœ¯å¹³å‡ï¼šæ³¢åŠ¨æ‹–ç´¯æ•ˆåº”
    - ä¸­ä½æ•°æ¥è¿‘å‡å€¼ï¼šæ”¶ç›Šç‡åˆ†å¸ƒç›¸å¯¹å¯¹ç§°
    - ä¼—æ•°çš„å­˜åœ¨ï¼šå¸‚åœºå­˜åœ¨"æ­£å¸¸"æ”¶ç›Šç‡åŒºé—´

    å‚æ•°ï¼š
        ticker: è‚¡ç¥¨/ETFä»£ç ï¼Œé»˜è®¤SPY
        start: å¼€å§‹æ—¥æœŸï¼Œæ ¼å¼'YYYY-MM-DD'
        end: ç»“æŸæ—¥æœŸï¼Œæ ¼å¼'YYYY-MM-DD'

    è¿”å›ï¼š
        FinanceMeansResult: åŒ…å«å„ç§ç»Ÿè®¡é‡å’ŒéªŒè¯ç»“æœ

    å¼‚å¸¸ï¼š
        RuntimeError: yfinanceæœªå®‰è£…æˆ–æ•°æ®è·å–å¤±è´¥

    è¿”å›å€¼ä¸­åŒ…å«ç”¨å‡ ä½•å¹³å‡æ”¶ç›Šç‡åæ¨çš„ä»·æ ¼æ£€éªŒï¼Œä»¥å¯¹ç…§éªŒè¯è®¡ç®—ã€‚
    """
    if not YFINANCE_AVAILABLE:
        raise RuntimeError(
            "yfinance æœªå®‰è£…ï¼Œæ— æ³•æ‰§è¡Œé‡‘èæ•°æ®ç¤ºä¾‹ã€‚è¯·å…ˆå®‰è£…ï¼šuv add yfinance",
        )

    data = yf.download(
        ticker,
        start=start,
        end=end,
        progress=False,
        auto_adjust=True,  # æ˜¾å¼æŒ‡å®šä»¥é¿å…é»˜è®¤å€¼å˜æ›´å‘Šè­¦
    )
    if data.empty:
        raise RuntimeError("ä¸‹è½½åˆ°çš„è¡Œæƒ…æ•°æ®ä¸ºç©ºï¼Œè¯·æ£€æŸ¥ä»£ç æˆ–ç½‘ç»œç¯å¢ƒã€‚")

    prices = data["Close"].astype(float)
    returns = prices.pct_change().dropna()

    if returns.empty:
        raise RuntimeError("æ”¶ç›Šç‡åºåˆ—ä¸ºç©ºï¼Œè¯·æ£€æŸ¥æ—¶é—´èŒƒå›´æˆ–æ•°æ®å¯ç”¨æ€§ã€‚")

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    #                           æ”¶ç›Šç‡ç»Ÿè®¡é‡è®¡ç®—
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    # 1. ç®—æœ¯å¹³å‡æ”¶ç›Šç‡ (æœŸæœ›æ”¶ç›Šç‡)
    # å…¬å¼ï¼šE[R] = (1/n) Ã— Î£ R_i
    # é‡‘èæ„ä¹‰ï¼šæœªæ¥æ”¶ç›Šç‡çš„æœŸæœ›å€¼ï¼Œç”¨äºèµ„äº§é…ç½®å’Œé£é™©è°ƒæ•´
    # ç‰¹ç‚¹ï¼šå¯¹æç«¯å€¼æ•æ„Ÿï¼Œå¯èƒ½é«˜ä¼°æˆ–ä½ä¼°é•¿æœŸæ”¶ç›Š
    mean_value = float(np.mean(returns.to_numpy()))

    # 2. ä¸­ä½æ•°æ”¶ç›Šç‡ (ç¨³å¥ä¸­å¿ƒè¶‹åŠ¿)
    # å®šä¹‰ï¼šå°†æ”¶ç›Šç‡æ’åºåçš„ä¸­ä½æ•°
    # é‡‘èæ„ä¹‰ï¼š50%çš„äº¤æ˜“æ—¥æ”¶ç›Šç‡ä½äºæ­¤å€¼ï¼Œ50%é«˜äºæ­¤å€¼
    # ç‰¹ç‚¹ï¼šå¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿï¼Œæ›´ç¨³å¥çš„ä¸­å¿ƒåº¦é‡
    median_value = float(np.median(returns.to_numpy()))

    # 3. ä¼—æ•°æ”¶ç›Šç‡ (æœ€å¸¸è§æ”¶ç›Šç‡)
    # ä¸ºäº†åˆ†ç»„æ›´ç¨³å®šï¼Œå¯¹æ”¶ç›Šç‡å››èˆäº”å…¥åˆ° 4 ä½å°æ•° (0.01% ç²¾åº¦)
    # é‡‘èæ„ä¹‰ï¼šå¸‚åœº"æ­£å¸¸"çŠ¶æ€ä¸‹æœ€å¯èƒ½å‡ºç°çš„æ”¶ç›Šç‡æ°´å¹³
    # åº”ç”¨ï¼šè¯†åˆ«å¸‚åœºçš„å…¸å‹è¡¨ç°ï¼Œå‘ç°å¤šå³°åˆ†å¸ƒ(å¤šç§å¸‚åœºçŠ¶æ€)
    mode_array = np.asarray(returns.round(4).to_numpy(), dtype=float).reshape(-1)
    mode_value = calculate_mode(mode_array.tolist())

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    #                        å‡ ä½•å¹³å‡æ”¶ç›Šç‡è®¡ç®—ä¸éªŒè¯
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    # 4. å‡ ä½•å¹³å‡æ”¶ç›Šç‡ (å¤åˆå¢é•¿ç‡)
    # å…¬å¼ï¼šR_g = [(1+Râ‚)(1+Râ‚‚)...(1+Râ‚™)]^(1/n) - 1
    #      = [âˆ(1+R_i)]^(1/n) - 1
    # ç­‰ä»·äºï¼šgmean(1 + r) - 1
    #
    # æ•°å­¦åŸç†ï¼š
    # - å°†ä¹˜æ€§è¿‡ç¨‹è½¬æ¢ä¸ºå‡ ä½•å¹³å‡
    # - è€ƒè™‘å¤åˆ©æ•ˆåº”ï¼Œåæ˜ çœŸå®çš„é•¿æœŸå¢é•¿ç‡
    # - æ€»æ˜¯ â‰¤ ç®—æœ¯å¹³å‡æ”¶ç›Šç‡ (AM-GMä¸ç­‰å¼)
    #
    # é‡‘èæ„ä¹‰ï¼š
    # - æ—¶é—´åŠ æƒæ”¶ç›Šç‡ï¼Œæ¶ˆé™¤ç°é‡‘æµæ—¶é—´å½±å“
    # - é•¿æœŸæŠ•èµ„çš„å®é™…å¹´åŒ–æ”¶ç›Šç‡
    # - å¤åˆ©å¢é•¿çš„å¹³å‡é€Ÿåº¦
    gmean_val = stats.gmean(returns.to_numpy() + 1.0)
    gmean_scalar = np.squeeze(np.asarray(gmean_val)).item()
    geo_mean_return = gmean_scalar - 1.0

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    #                            ä»·æ ¼è·¯å¾„éªŒè¯
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    # æå–å…³é”®ä»·æ ¼ç‚¹è¿›è¡ŒéªŒè¯
    initial_price = np.asarray(prices.to_numpy()[0]).item()  # æœŸåˆä»·æ ¼
    final_price = np.asarray(prices.to_numpy()[-1]).item()  # æœŸæœ«ä»·æ ¼
    T = returns.shape[0]  # äº¤æ˜“æœŸæ•°

    # å‡ ä½•å¹³å‡æ”¶ç›Šç‡éªŒè¯å…¬å¼ï¼š
    # P_T = P_0 Ã— (1 + R_g)^T
    #
    # éªŒè¯é€»è¾‘ï¼š
    # - å¦‚æœå‡ ä½•å¹³å‡æ”¶ç›Šç‡è®¡ç®—æ­£ç¡®ï¼Œåæ¨çš„ä»·æ ¼åº”è¯¥ç­‰äºå®é™…æœ€ç»ˆä»·æ ¼
    # - è¯¯å·®æ¥æºï¼šæ•°å€¼ç²¾åº¦ã€å¤åˆ©è®¡ç®—çš„ç´¯ç§¯è¯¯å·®
    # - é€šå¸¸è¯¯å·®åº”è¯¥å¾ˆå° (< 0.01%)
    calculated_price = float(initial_price * (1.0 + geo_mean_return) ** T)

    # éªŒè¯è¯´æ˜ï¼š
    # calculated_price â‰ˆ final_price è¯´æ˜å‡ ä½•å¹³å‡æ”¶ç›Šç‡è®¡ç®—æ­£ç¡®
    # å¦‚æœå·®å¼‚è¾ƒå¤§ï¼Œå¯èƒ½å­˜åœ¨ï¼š
    # 1. æ•°æ®è´¨é‡é—®é¢˜ï¼ˆåˆ†çº¢ã€æ‹†è‚¡ç­‰æœªè°ƒæ•´ï¼‰
    # 2. è®¡ç®—ç²¾åº¦é—®é¢˜
    # 3. æ—¶é—´åºåˆ—ä¸è¿ç»­

    return FinanceMeansResult(
        mean=mean_value,
        median=median_value,
        mode=mode_value,
        geometric_mean_return=geo_mean_return,
        actual_final_price=final_price,
        gmean_check_price=calculated_price,
        periods=T,
    )


def _print_basic_result(result: BasicMeansResult) -> None:
    print("\n" + "=" * 60)
    print("åŸºç¡€ç»Ÿè®¡é‡ç¤ºä¾‹ç»“æœåˆ†æ")
    print("=" * 60)

    print("\nğŸ“Š æ•°æ®é›†å¯¹æ¯”ï¼š")
    print("   x1 = [1,2,2,3,4,5,5,7] (æ­£å¸¸æ•°æ®)")
    print("   x2 = x1 + [100] (æ·»åŠ å¼‚å¸¸å€¼)")

    print("\nğŸ“ˆ ç®—æœ¯å¹³å‡æ•° (å¯¹å¼‚å¸¸å€¼æ•æ„Ÿ)ï¼š")
    print(f"   x1: {result.mean_x1:.2f} | x2: {result.mean_x2:.2f}")
    print(
        f"   ğŸ“ å¼‚å¸¸å€¼å½±å“ï¼š{result.mean_x2 - result.mean_x1:.2f} (+{(result.mean_x2 / result.mean_x1 - 1) * 100:.0f}%)",
    )

    print("\nğŸ“Š ä¸­ä½æ•° (å¯¹å¼‚å¸¸å€¼ç¨³å¥)ï¼š")
    print(f"   x1: {result.median_x1} | x2: {result.median_x2}")
    print("   ğŸ“ ç¨³å¥æ€§ï¼šå‡ ä¹ä¸å—å¼‚å¸¸å€¼å½±å“")

    print("\nğŸ¯ ä¼—æ•° (æœ€é¢‘ç¹å€¼)ï¼š")
    print(f"   x1: {result.mode_x1} | x2: {result.mode_x2}")
    print("   ğŸ“ è§£é‡Šï¼š[2,5] è¡¨ç¤ºæœ‰ä¸¤ä¸ªä¼—æ•°ï¼Œéƒ½å‡ºç°2æ¬¡")

    print("\nğŸ“ å‡ ä½•å¹³å‡æ•° (å¢é•¿ç‡å¹³å‡)ï¼š")
    print(f"   x1: {result.gmean_x1:.2f} | x2: {result.gmean_x2:.2f}")
    print("   ğŸ“ ç‰¹æ€§ï¼šG < ç®—æœ¯å¹³å‡ (AM-GMä¸ç­‰å¼)")

    print("\nâš–ï¸  è°ƒå’Œå¹³å‡æ•° (å€’æ•°çš„å¹³å‡)ï¼š")
    print(f"   x1: {result.hmean_x1:.2f} | x2: {result.hmean_x2:.2f}")
    print("   ğŸ“ å…³ç³»ï¼šè°ƒå’Œ â‰¤ å‡ ä½• â‰¤ ç®—æœ¯ å¹³å‡")

    print("\nğŸ” æ•°å­¦å…³ç³»éªŒè¯ï¼š")
    print(
        f"   x1: {result.hmean_x1:.2f} â‰¤ {result.gmean_x1:.2f} â‰¤ {result.mean_x1:.2f}",
    )
    print(
        f"   x2: {result.hmean_x2:.2f} â‰¤ {result.gmean_x2:.2f} â‰¤ {result.mean_x2:.2f}",
    )

    print("\nğŸ’¡ å…³é”®æ´å¯Ÿï¼š")
    print(
        f"   â€¢ å¼‚å¸¸å€¼å¯¹ç®—æœ¯å¹³å‡å½±å“æœ€å¤§ (+{(result.mean_x2 / result.mean_x1 - 1) * 100:.0f}%)",
    )
    print("   â€¢ ä¸­ä½æ•°æœ€ç¨³å¥ï¼Œå‡ ä¹ä¸å˜")
    print("   â€¢ å‡ ä½•å¹³å‡ä»‹äºä¸¤è€…ä¹‹é—´")
    print("   â€¢ ä¸‰ç§å¹³å‡æ•°çš„å¤§å°å…³ç³»å§‹ç»ˆæˆç«‹")


def _print_finance_result(result: FinanceMeansResult) -> None:
    print("\n" + "=" * 60)
    print("SPY ETF æ”¶ç›Šç‡åˆ†æç»“æœ")
    print("=" * 60)

    # è®¡ç®—å¹´åŒ–æŒ‡æ ‡
    annual_mean = result.mean * 252
    annual_geom = ((1 + result.geometric_mean_return) ** 252) - 1
    price_error = abs(result.actual_final_price - result.gmean_check_price)
    price_error_pct = (price_error / result.actual_final_price) * 100

    print("\nğŸ“Š æ”¶ç›Šç‡ç»Ÿè®¡ç‰¹å¾ï¼š")
    print(f"   æ ·æœ¬æœŸæ•°: {result.periods} ä¸ªäº¤æ˜“æ—¥")
    print(f"   æ•°æ®æœŸé—´: çº¦ {result.periods / 252:.1f} å¹´")

    print("\nğŸ“ˆ æ—¥æ”¶ç›Šç‡åˆ†æï¼š")
    print(f"   ç®—æœ¯å¹³å‡: {result.mean:.4f} ({result.mean * 100:.2f}%)")
    print(f"   ä¸­ ä½ æ•°: {result.median:.4f} ({result.median * 100:.2f}%)")
    print(f"   ä¼—    æ•°: {result.mode}")
    print(
        f"   å‡ ä½•å¹³å‡: {result.geometric_mean_return:.4f} ({result.geometric_mean_return * 100:.2f}%)",
    )

    print("\nğŸ“… å¹´åŒ–æ”¶ç›Šç‡ (252ä¸ªäº¤æ˜“æ—¥)ï¼š")
    print(f"   ç®—æœ¯å¹³å‡å¹´åŒ–: {annual_mean:.4f} ({annual_mean * 100:.2f}%)")
    print(f"   å‡ ä½•å¹³å‡å¹´åŒ–: {annual_geom:.4f} ({annual_geom * 100:.2f}%)")
    print(f"   ğŸ“ å·®å¼‚: {(annual_mean - annual_geom) * 100:.2f}% (æ³¢åŠ¨æ‹–ç´¯æ•ˆåº”)")

    print("\nğŸ’° ä»·æ ¼éªŒè¯ï¼š")
    print(f"   å®é™…æœ€ç»ˆä»·æ ¼: ${result.actual_final_price:.2f}")
    print(f"   å‡ ä½•å¹³å‡éªŒè¯: ${result.gmean_check_price:.2f}")
    print(f"   ç»å¯¹è¯¯å·®: ${price_error:.2f}")
    print(f"   ç›¸å¯¹è¯¯å·®: {price_error_pct:.4f}%")
    if price_error_pct < 0.01:
        print("   âœ… éªŒè¯é€šè¿‡ï¼šè¯¯å·®æå°ï¼Œè®¡ç®—æ­£ç¡®")
    else:
        print("   âš ï¸  éªŒè¯è­¦å‘Šï¼šè¯¯å·®è¾ƒå¤§ï¼Œè¯·æ£€æŸ¥æ•°æ®è´¨é‡")

    print("\nğŸ” é‡‘èç›´è§‰è§£è¯»ï¼š")
    if result.mean > result.median:
        print("   â€¢ å‡å€¼ > ä¸­ä½æ•°ï¼šæ”¶ç›Šç‡å‘ˆå³ååˆ†å¸ƒ (æ­£åæ€)")
        print("   â€¢ è§£é‡Šï¼šå­˜åœ¨å°‘æ•°å¤§æ¶¨æ—¥æ‹‰é«˜å¹³å‡æ”¶ç›Š")
    elif result.mean < result.median:
        print("   â€¢ å‡å€¼ < ä¸­ä½æ•°ï¼šæ”¶ç›Šç‡å‘ˆå·¦ååˆ†å¸ƒ (è´Ÿåæ€)")
        print("   â€¢ è§£é‡Šï¼šå­˜åœ¨å°‘æ•°å¤§è·Œæ—¥æ‹‰ä½å¹³å‡æ”¶ç›Š")
    else:
        print("   â€¢ å‡å€¼ â‰ˆ ä¸­ä½æ•°ï¼šæ”¶ç›Šç‡åˆ†å¸ƒç›¸å¯¹å¯¹ç§°")

    print(f"   â€¢ å‡ ä½•å¹³å‡ < ç®—æœ¯å¹³å‡ï¼š{(annual_mean - annual_geom) * 100:.2f}%")
    print("   â€¢ è¿™æ˜¯'æ³¢åŠ¨æ‹–ç´¯'ï¼šæ³¢åŠ¨æ€§é™ä½å¤åˆå¢é•¿ç‡")
    print("   â€¢ ä¼—æ•°æ˜¾ç¤ºæœ€å¸¸è§çš„æ”¶ç›Šç‡æ°´å¹³")

    print("\nğŸ’¡ æŠ•èµ„å¯ç¤ºï¼š")
    if annual_geom > 0:
        print(f"   âœ… é•¿æœŸè¶‹åŠ¿ï¼šå¹´åŒ–å¤åˆæ”¶ç›Šç‡ +{annual_geom * 100:.2f}%")
        print("   ğŸ“ˆ æŠ•èµ„å»ºè®®ï¼šé€‚åˆé•¿æœŸæŒæœ‰çš„ä¼˜è´¨èµ„äº§")
    else:
        print(f"   âŒ é•¿æœŸè¶‹åŠ¿ï¼šå¹´åŒ–å¤åˆæ”¶ç›Šç‡ {annual_geom * 100:.2f}%")
        print("   ğŸ“‰ æŠ•èµ„è­¦ç¤ºï¼šè¯¥æœŸé—´è¡¨ç°ä¸ä½³")

    print("   â€¢ å‡ ä½•å¹³å‡æ›´é€‚åˆè¯„ä¼°é•¿æœŸæŠ•èµ„è¡¨ç°")
    print("   â€¢ ç®—æœ¯å¹³å‡æ›´é€‚åˆçŸ­æœŸæœŸæœ›æ”¶ç›Šä¼°ç®—")
    print("   â€¢ ä¸­ä½æ•°æä¾›ç¨³å¥çš„æ”¶ç›Šç‡é¢„æœŸ")


def main() -> None:
    # 1) åŸºç¡€ç»Ÿè®¡é‡æ¼”ç¤º
    basic = demo_basic_means()
    _print_basic_result(basic)

    # 2) é‡‘èæ•°æ®æ¼”ç¤º
    if YFINANCE_AVAILABLE:
        try:
            finance = demo_finance_means()
            _print_finance_result(finance)
        except Exception as exc:  # é¿å…è£¸ exceptï¼Œæ‰“å°æ˜ç¡®é”™è¯¯
            print(f"\né‡‘èæ•°æ®ç¤ºä¾‹è¿è¡Œå¤±è´¥: {exc}")
            print("æç¤ºï¼šæ£€æŸ¥ç½‘ç»œæˆ–ä½¿ç”¨ 'uv add yfinance' å®‰è£…ä¾èµ–åé‡è¯•ã€‚")
    else:
        print("\nè·³è¿‡é‡‘èæ•°æ®ç¤ºä¾‹ï¼šæœªå®‰è£… yfinanceï¼Œè¿è¡Œ 'uv add yfinance' åé‡è¯•ã€‚")


if __name__ == "__main__":
    main()
